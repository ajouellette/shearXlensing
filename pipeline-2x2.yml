nside: 2048
# specify binning scheme
binning:
    kind: linear
    ell_min: 10
    ell_max: 3500
    nbpws: 24
# place to save namaster workspaces
workspace_dir: "/home/aaronjo2/scratch/nmt_workspaces"

# specify tracers, each can have multiple tomographic bins
# can use python format strings to specify location of maps/masks
#   known variables: bin and nside
tracers:
    wl:
      name: "DES-Y3 shear maps"
      bins: 4
      data_dir: "/projects/caps/aaronjo2/shearXlensing/data/des_y3/maps"
      beam: pixwin
      healpix:
          map: "DESY3_zbin{bin}_nside{nside}_shearmaps.fits"
          mask: "DESY3_zbin{bin}_nside{nside}_mask.fits"
          #noise_est: [2.346129e-4, 2.213803e-4, 1.466034e-4, 9.738680e-5]  # 1024
          noise_est: [1.46633e-05, 1.38363e-05, 9.16271e-06, 6.08668e-06]  # 2048
      # Fix sign convention for e1/e2 to that of Q/U: (e1, e2) -> (-e1, e2)
      correct_qu_sign: True
   #wl_cat:
   #  name: "DES-Y3 shear catalogs"
   #  bins: 4
   #  data_dir: "/projects/caps/aaronjo2/shearXlensing/data/des_y3/calibrated_catalogs"
   #  catalog:
   #      file: "DESY3_shearcat_zbin{bin}.fits"
   #      fields: ["g_1", "g_2"]
   #  correct_qu_sign: True
    ck:
      name: "SPT-3G CMB convergence"
      data_dir: "/projects/caps/aaronjo2/shearXlensing/data/spt"
      healpix:
          map: "kmapxx_0_mfhalf1_{nside}.fits"
          mask: "mask{nside}_border_apod_mask.fits"
      # square mask for CMB lensing field
      use_mask_squared: True
    ck_pol:
      name: "SPT-3G pol-only CMB convergence"
      data_dir: "/projects/caps/aaronjo2/shearXlensing/data/spt"
      healpix:
          map: "kmapxx_kPP_0_mfhalf1_{nside}.fits"
          mask: "mask{nside}_border_apod_mask.fits"
      # square mask for CMB lensing field
      use_mask_squared: True

    #wl_psf:
    #    name: "DES-Y3 PSF ellipticity maps"
    #    bins: 4
    #    data_dir: "/projects/caps/aaronjo2/shearXlensing/data/des_y3/maps"
    #    healpix:
    #        map: "DESY3_zbin{bin}_nside{nside}_psfmaps.fits"
    #        mask: "DESY3_zbin{bin}_nside{nside}_mask.fits"
    #    correct_qu_sign: True


# specify sets of cross-spectra (and corresponding covariances) to calculate
cross_spectra:
    # specific x-spectra to calculate given as tuples of 2 tracers
    list:
        - [ck, wl]
        - [wl, wl]
    # calculate covariance
    covariance: True
    interbin_cov: True
    subtract_noise: True
    # save all cls and covs in a .npz file
    # simply dumps full namaster output without any post-processing
    save_npz: "data/cross_cls/cross_spectra_2x2_nside{nside}.npz"
    # save select cls and their full cov (+ tracer info) in a sacc file
    save_sacc:
        metadata:
            description: "SPT-3G CMB lensing X DES-Y3 shear (2x2)"
        file: "data/cross_cls/cross_spectra_2x2_nside{nside}.fits"

cross_spectra_pol:
    list:
        - [ck_pol, wl]
        - [wl, wl]
    covariance: True
    interbin_cov: True
    subtract_noise: True
    save_npz: "data/cross_cls/cross_spectra_pol_2x2_nside{nside}.npz"
    save_sacc:
        metadata:
            description: "SPT-3G CMB lensing (pol) x DES Y3 shear (2x2)"
        file: "data/cross_cls/cross_spectra_pol_2x2_nside{nside}.fits"

#cross_spectra_cat:
#    list:
#        - [ck, wl_cat]
#    save_npz: "data/cross_cls/cross_spectra_nside{nside}_catalog.npz"
#
#cross_spectra_cat_pol:
#    list:
#        - [ck_pol, wl_cat]
#    save_npz: "data/cross_cls/cross_spectra_pol_nside{nside}_catalog.npz"

#cross_spectra_wl_psf:
#    list:
#        - [tracer_wl_psf, tracer_wl]
#    covariance: True
#    interbin_cov: False
